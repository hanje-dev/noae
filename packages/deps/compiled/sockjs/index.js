(()=>{var e={1411:(e,t,r)=>{"use strict";var s=r(2413).Stream,i=r(1669),n=r(3436),o=r(8642),a=r(8414),h=r(7213),c=r(4633);var EventSource=function(e,t,r){this.writable=true;r=r||{};this._stream=t.socket;this._ping=r.ping||this.DEFAULT_PING;this._retry=r.retry||this.DEFAULT_RETRY;var s=n.isSecureRequest(e)?"https:":"http:";this.url=s+"//"+e.headers.host+e.url;this.lastEventId=e.headers["last-event-id"]||"";this.readyState=a.CONNECTING;var i=new o,h=this;if(r.headers){for(var c in r.headers)i.set(c,r.headers[c])}if(!this._stream||!this._stream.writable)return;process.nextTick((function(){h._open()}));this._stream.setTimeout(0);this._stream.setNoDelay(true);var u="HTTP/1.1 200 OK\r\n"+"Content-Type: text/event-stream\r\n"+"Cache-Control: no-cache, no-store\r\n"+"Connection: close\r\n"+i.toString()+"\r\n"+"retry: "+Math.floor(this._retry*1e3)+"\r\n\r\n";this._write(u);this._stream.on("drain",(function(){h.emit("drain")}));if(this._ping)this._pingTimer=setInterval((function(){h.ping()}),this._ping*1e3);["error","end"].forEach((function(e){h._stream.on(e,(function(){h.close()}))}))};i.inherits(EventSource,s);EventSource.isEventSource=function(e){if(e.method!=="GET")return false;var t=(e.headers.accept||"").split(/\s*,\s*/);return t.indexOf("text/event-stream")>=0};var u={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(e){if(!this.writable)return false;try{return this._stream.write(e,"utf8")}catch(e){return false}},_open:function(){if(this.readyState!==a.CONNECTING)return;this.readyState=a.OPEN;var e=new c("open");e.initEvent("open",false,false);this.dispatchEvent(e)},write:function(e){return this.send(e)},end:function(e){if(e!==undefined)this.write(e);this.close()},send:function(e,t){if(this.readyState>a.OPEN)return false;e=String(e).replace(/(\r\n|\r|\n)/g,"$1data: ");t=t||{};var r="";if(t.event)r+="event: "+t.event+"\r\n";if(t.id)r+="id: "+t.id+"\r\n";r+="data: "+e+"\r\n\r\n";return this._write(r)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>a.OPEN)return false;this.readyState=a.CLOSED;this.writable=false;if(this._pingTimer)clearInterval(this._pingTimer);if(this._stream)this._stream.end();var e=new c("close");e.initEvent("close",false,false);this.dispatchEvent(e);return true}};for(var f in u)EventSource.prototype[f]=u[f];for(var p in h)EventSource.prototype[p]=h[p];e.exports=EventSource},2178:(e,t,r)=>{"use strict";var s=r(1669),i=r(3436),n=r(8414);var WebSocket=function(e,t,r,s,o){o=o||{};this._stream=t;this._driver=i.http(e,{maxLength:o.maxLength,protocols:s});var a=this;if(!this._stream||!this._stream.writable)return;if(!this._stream.readable)return this._stream.end();var catchup=function(){a._stream.removeListener("data",catchup)};this._stream.on("data",catchup);n.call(this,o);process.nextTick((function(){a._driver.start();a._driver.io.write(r)}))};s.inherits(WebSocket,n);WebSocket.isWebSocket=function(e){return i.isWebSocket(e)};WebSocket.validateOptions=function(e,t){i.validateOptions(e,t)};WebSocket.WebSocket=WebSocket;WebSocket.Client=r(5429);WebSocket.EventSource=r(1411);e.exports=WebSocket},8414:(e,t,r)=>{"use strict";var s=r(2413).Stream,i=r(1669),n=r(3436),o=r(7213),a=r(4633);var API=function(e){e=e||{};n.validateOptions(e,["headers","extensions","maxLength","ping","proxy","tls","ca"]);this.readable=this.writable=true;var t=e.headers;if(t){for(var r in t)this._driver.setHeader(r,t[r])}var s=e.extensions;if(s){[].concat(s).forEach(this._driver.addExtension,this._driver)}this._ping=e.ping;this._pingId=0;this.readyState=API.CONNECTING;this.bufferedAmount=0;this.protocol="";this.url=this._driver.url;this.version=this._driver.version;var i=this;this._driver.on("open",(function(e){i._open()}));this._driver.on("message",(function(e){i._receiveMessage(e.data)}));this._driver.on("close",(function(e){i._beginClose(e.reason,e.code)}));this._driver.on("error",(function(e){i._emitError(e.message)}));this.on("error",(function(){}));this._driver.messages.on("drain",(function(){i.emit("drain")}));if(this._ping)this._pingTimer=setInterval((function(){i._pingId+=1;i.ping(i._pingId.toString())}),this._ping*1e3);this._configureStream();if(!this._proxy){this._stream.pipe(this._driver.io);this._driver.io.pipe(this._stream)}};i.inherits(API,s);API.CONNECTING=0;API.OPEN=1;API.CLOSING=2;API.CLOSED=3;API.CLOSE_TIMEOUT=3e4;var h={write:function(e){return this.send(e)},end:function(e){if(e!==undefined)this.send(e);this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(e){if(this.readyState>API.OPEN)return false;if(!(e instanceof Buffer))e=String(e);return this._driver.messages.write(e)},ping:function(e,t){if(this.readyState>API.OPEN)return false;return this._driver.ping(e,t)},close:function(e,t){if(e===undefined)e=1e3;if(t===undefined)t="";if(e!==1e3&&(e<3e3||e>4999))throw new Error("Failed to execute 'close' on WebSocket: "+"The code must be either 1000, or between 3000 and 4999. "+e+" is neither.");if(this.readyState<API.CLOSING){var r=this;this._closeTimer=setTimeout((function(){r._beginClose("",1006)}),API.CLOSE_TIMEOUT)}if(this.readyState!==API.CLOSED)this.readyState=API.CLOSING;this._driver.close(t,e)},_configureStream:function(){var e=this;this._stream.setTimeout(0);this._stream.setNoDelay(true);["close","end"].forEach((function(t){this._stream.on(t,(function(){e._finalizeClose()}))}),this);this._stream.on("error",(function(t){e._emitError("Network error: "+e.url+": "+t.message);e._finalizeClose()}))},_open:function(){if(this.readyState!==API.CONNECTING)return;this.readyState=API.OPEN;this.protocol=this._driver.protocol||"";var e=new a("open");e.initEvent("open",false,false);this.dispatchEvent(e)},_receiveMessage:function(e){if(this.readyState>API.OPEN)return false;if(this.readable)this.emit("data",e);var t=new a("message",{data:e});t.initEvent("message",false,false);this.dispatchEvent(t)},_emitError:function(e){if(this.readyState>=API.CLOSING)return;var t=new a("error",{message:e});t.initEvent("error",false,false);this.dispatchEvent(t)},_beginClose:function(e,t){if(this.readyState===API.CLOSED)return;this.readyState=API.CLOSING;this._closeParams=[e,t];if(this._stream){this._stream.destroy();if(!this._stream.readable)this._finalizeClose()}},_finalizeClose:function(){if(this.readyState===API.CLOSED)return;this.readyState=API.CLOSED;if(this._closeTimer)clearTimeout(this._closeTimer);if(this._pingTimer)clearInterval(this._pingTimer);if(this._stream)this._stream.end();if(this.readable)this.emit("end");this.readable=this.writable=false;var e=this._closeParams?this._closeParams[0]:"",t=this._closeParams?this._closeParams[1]:1006;var r=new a("close",{code:t,reason:e});r.initEvent("close",false,false);this.dispatchEvent(r)}};for(var c in h)API.prototype[c]=h[c];for(var u in o)API.prototype[u]=o[u];e.exports=API},4633:e=>{"use strict";var Event=function(e,t){this.type=e;for(var r in t)this[r]=t[r]};Event.prototype.initEvent=function(e,t,r){this.type=e;this.bubbles=t;this.cancelable=r};Event.prototype.stopPropagation=function(){};Event.prototype.preventDefault=function(){};Event.CAPTURING_PHASE=1;Event.AT_TARGET=2;Event.BUBBLING_PHASE=3;e.exports=Event},7213:(e,t,r)=>{"use strict";var s=r(4633);var i={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(e,t,r){this.on(e,t)},removeEventListener:function(e,t,r){this.removeListener(e,t)},dispatchEvent:function(e){e.target=e.currentTarget=this;e.eventPhase=s.AT_TARGET;if(this["on"+e.type])this["on"+e.type](e);this.emit(e.type,e)}};e.exports=i},5429:(e,t,r)=>{"use strict";var s=r(1669),i=r(1631),n=r(4016),o=r(8835),a=r(3436),h=r(8414),c=r(4633);var u={"http:":80,"https:":443,"ws:":80,"wss:":443},f=["https:","wss:"];var Client=function(e,t,r){r=r||{};this.url=e;this._driver=a.client(this.url,{maxLength:r.maxLength,protocols:t});["open","error"].forEach((function(e){this._driver.on(e,(function(){g.headers=g._driver.headers;g.statusCode=g._driver.statusCode}))}),this);var s=r.proxy||{},c=o.parse(s.origin||this.url),p=c.port||u[c.protocol],l=f.indexOf(c.protocol)>=0,onConnect=function(){g._onConnect()},d=r.net||{},_=r.tls||{},v=s.origin?s.tls||{}:_,g=this;d.host=v.host=c.hostname;d.port=v.port=p;_.ca=_.ca||r.ca;v.servername=v.servername||c.hostname;this._stream=l?n.connect(v,onConnect):i.connect(d,onConnect);if(s.origin)this._configureProxy(s,_);h.call(this,r)};s.inherits(Client,h);Client.prototype._onConnect=function(){var e=this._proxy||this._driver;e.start()};Client.prototype._configureProxy=function(e,t){var r=o.parse(this.url),s=f.indexOf(r.protocol)>=0,i=this,a;this._proxy=this._driver.proxy(e.origin);if(e.headers){for(a in e.headers)this._proxy.setHeader(a,e.headers[a])}this._proxy.pipe(this._stream,{end:false});this._stream.pipe(this._proxy);this._proxy.on("connect",(function(){if(s){var e={socket:i._stream,servername:r.hostname};for(a in t)e[a]=t[a];i._stream=n.connect(e);i._configureStream()}i._driver.io.pipe(i._stream);i._stream.pipe(i._driver.io);i._driver.start()}));this._proxy.on("error",(function(e){i._driver.emit("error",e)}))};e.exports=Client},508:(e,t,r)=>{var s;var i=r(2357);t.m=HTTPParser;function HTTPParser(e){i.ok(e===HTTPParser.REQUEST||e===HTTPParser.RESPONSE||e===undefined);if(e===undefined){}else{this.initialize(e)}}HTTPParser.prototype.initialize=function(e,t){i.ok(e===HTTPParser.REQUEST||e===HTTPParser.RESPONSE);this.type=e;this.state=e+"_LINE";this.info={headers:[],upgrade:false};this.trailers=[];this.line="";this.isChunked=false;this.connection="";this.headerSize=0;this.body_bytes=null;this.isUserCall=false;this.hadError=false};HTTPParser.encoding="ascii";HTTPParser.maxHeaderSize=80*1024;HTTPParser.REQUEST="REQUEST";HTTPParser.RESPONSE="RESPONSE";var n=HTTPParser.kOnHeaders=1;var o=HTTPParser.kOnHeadersComplete=2;var a=HTTPParser.kOnBody=3;var h=HTTPParser.kOnMessageComplete=4;HTTPParser.prototype[n]=HTTPParser.prototype[o]=HTTPParser.prototype[a]=HTTPParser.prototype[h]=function(){};var c=true;Object.defineProperty(HTTPParser,"kOnExecute",{get:function(){c=false;return 99}});var u=s=HTTPParser.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK"];var f=u.indexOf("CONNECT");HTTPParser.prototype.reinitialize=HTTPParser;HTTPParser.prototype.close=HTTPParser.prototype.pause=HTTPParser.prototype.resume=HTTPParser.prototype.free=function(){};HTTPParser.prototype._compatMode0_11=false;HTTPParser.prototype.getAsyncId=function(){return 0};var p={REQUEST_LINE:true,RESPONSE_LINE:true,HEADER:true};HTTPParser.prototype.execute=function(e,t,r){if(!(this instanceof HTTPParser)){throw new TypeError("not a HTTPParser")}t=t||0;r=typeof r==="number"?r:e.length;this.chunk=e;this.offset=t;var s=this.end=t+r;try{while(this.offset<s){if(this[this.state]()){break}}}catch(e){if(this.isUserCall){throw e}this.hadError=true;return e}this.chunk=null;r=this.offset-t;if(p[this.state]){this.headerSize+=r;if(this.headerSize>HTTPParser.maxHeaderSize){return new Error("max header size exceeded")}}return r};var l={REQUEST_LINE:true,RESPONSE_LINE:true,BODY_RAW:true};HTTPParser.prototype.finish=function(){if(this.hadError){return}if(!l[this.state]){return new Error("invalid state for EOF")}if(this.state==="BODY_RAW"){this.userCall()(this[h]())}};HTTPParser.prototype.consume=HTTPParser.prototype.unconsume=HTTPParser.prototype.getCurrentBuffer=function(){};HTTPParser.prototype.userCall=function(){this.isUserCall=true;var e=this;return function(t){e.isUserCall=false;return t}};HTTPParser.prototype.nextRequest=function(){this.userCall()(this[h]());this.reinitialize(this.type)};HTTPParser.prototype.consumeLine=function(){var e=this.end,t=this.chunk;for(var r=this.offset;r<e;r++){if(t[r]===10){var s=this.line+t.toString(HTTPParser.encoding,this.offset,r);if(s.charAt(s.length-1)==="\r"){s=s.substr(0,s.length-1)}this.line="";this.offset=r+1;return s}}this.line+=t.toString(HTTPParser.encoding,this.offset,this.end);this.offset=this.end};var d=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/;var _=/^[ \t]+(.*[^ \t])/;HTTPParser.prototype.parseHeader=function(e,t){if(e.indexOf("\r")!==-1){throw parseErrorCode("HPE_LF_EXPECTED")}var r=d.exec(e);var s=r&&r[1];if(s){t.push(s);t.push(r[2])}else{var i=_.exec(e);if(i&&t.length){if(t[t.length-1]){t[t.length-1]+=" "}t[t.length-1]+=i[1]}}};var v=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;HTTPParser.prototype.REQUEST_LINE=function(){var e=this.consumeLine();if(!e){return}var t=v.exec(e);if(t===null){throw parseErrorCode("HPE_INVALID_CONSTANT")}this.info.method=this._compatMode0_11?t[1]:u.indexOf(t[1]);if(this.info.method===-1){throw new Error("invalid request method")}this.info.url=t[2];this.info.versionMajor=+t[3];this.info.versionMinor=+t[4];this.body_bytes=0;this.state="HEADER"};var g=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;HTTPParser.prototype.RESPONSE_LINE=function(){var e=this.consumeLine();if(!e){return}var t=g.exec(e);if(t===null){throw parseErrorCode("HPE_INVALID_CONSTANT")}this.info.versionMajor=+t[1];this.info.versionMinor=+t[2];var r=this.info.statusCode=+t[3];this.info.statusMessage=t[4];if((r/100|0)===1||r===204||r===304){this.body_bytes=0}this.state="HEADER"};HTTPParser.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(this.connection.indexOf("close")!==-1){return false}}else if(this.connection.indexOf("keep-alive")===-1){return false}if(this.body_bytes!==null||this.isChunked){return true}return false};HTTPParser.prototype.HEADER=function(){var e=this.consumeLine();if(e===undefined){return}var t=this.info;if(e){this.parseHeader(e,t.headers)}else{var r=t.headers;var s=false;var i;var n=false;for(var a=0;a<r.length;a+=2){switch(r[a].toLowerCase()){case"transfer-encoding":this.isChunked=r[a+1].toLowerCase()==="chunked";break;case"content-length":i=+r[a+1];if(s){if(i!==this.body_bytes){throw parseErrorCode("HPE_UNEXPECTED_CONTENT_LENGTH")}}else{s=true;this.body_bytes=i}break;case"connection":this.connection+=r[a+1].toLowerCase();break;case"upgrade":n=true;break}}if(this.isChunked&&s){s=false;this.body_bytes=null}if(n&&this.connection.indexOf("upgrade")!=-1){t.upgrade=this.type===HTTPParser.REQUEST||t.statusCode===101}else{t.upgrade=t.method===f}if(this.isChunked&&t.upgrade){this.isChunked=false}t.shouldKeepAlive=this.shouldKeepAlive();var h;if(c){h=this.userCall()(this[o](t))}else{h=this.userCall()(this[o](t.versionMajor,t.versionMinor,t.headers,t.method,t.url,t.statusCode,t.statusMessage,t.upgrade,t.shouldKeepAlive))}if(h===2){this.nextRequest();return true}else if(this.isChunked&&!h){this.state="BODY_CHUNKHEAD"}else if(h||this.body_bytes===0){this.nextRequest();return t.upgrade}else if(this.body_bytes===null){this.state="BODY_RAW"}else{this.state="BODY_SIZED"}}};HTTPParser.prototype.BODY_CHUNKHEAD=function(){var e=this.consumeLine();if(e===undefined){return}this.body_bytes=parseInt(e,16);if(!this.body_bytes){this.state="BODY_CHUNKTRAILERS"}else{this.state="BODY_CHUNK"}};HTTPParser.prototype.BODY_CHUNK=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[a](this.chunk,this.offset,e));this.offset+=e;this.body_bytes-=e;if(!this.body_bytes){this.state="BODY_CHUNKEMPTYLINE"}};HTTPParser.prototype.BODY_CHUNKEMPTYLINE=function(){var e=this.consumeLine();if(e===undefined){return}i.equal(e,"");this.state="BODY_CHUNKHEAD"};HTTPParser.prototype.BODY_CHUNKTRAILERS=function(){var e=this.consumeLine();if(e===undefined){return}if(e){this.parseHeader(e,this.trailers)}else{if(this.trailers.length){this.userCall()(this[n](this.trailers,""))}this.nextRequest()}};HTTPParser.prototype.BODY_RAW=function(){var e=this.end-this.offset;this.userCall()(this[a](this.chunk,this.offset,e));this.offset=this.end};HTTPParser.prototype.BODY_SIZED=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[a](this.chunk,this.offset,e));this.offset+=e;this.body_bytes-=e;if(!this.body_bytes){this.nextRequest()}};["Headers","HeadersComplete","Body","MessageComplete"].forEach((function(e){var t=HTTPParser["kOn"+e];Object.defineProperty(HTTPParser.prototype,"on"+e,{get:function(){return this[t]},set:function(e){this._compatMode0_11=true;f="CONNECT";return this[t]=e}})}));function parseErrorCode(e){var t=new Error("Parse Error");t.code=e;return t}},3118:(e,t,r)=>{
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var s=r(4293);var i=s.Buffer;function copyProps(e,t){for(var r in e){t[r]=e[r]}}if(i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow){e.exports=s}else{copyProps(s,t);t.Buffer=SafeBuffer}function SafeBuffer(e,t,r){return i(e,t,r)}SafeBuffer.prototype=Object.create(i.prototype);copyProps(i,SafeBuffer);SafeBuffer.from=function(e,t,r){if(typeof e==="number"){throw new TypeError("Argument must not be a number")}return i(e,t,r)};SafeBuffer.alloc=function(e,t,r){if(typeof e!=="number"){throw new TypeError("Argument must be a number")}var s=i(e);if(t!==undefined){if(typeof r==="string"){s.fill(t,r)}else{s.fill(t)}}else{s.fill(0)}return s};SafeBuffer.allocUnsafe=function(e){if(typeof e!=="number"){throw new TypeError("Argument must be a number")}return i(e)};SafeBuffer.allocUnsafeSlow=function(e){if(typeof e!=="number"){throw new TypeError("Argument must be a number")}return s.SlowBuffer(e)}},2387:(e,t,r)=>{e.exports=r(6809)},4237:function(e,t,r){(function(){var e;e=r(2120);t.app={chunking_test:function(t,r,s,i){var n;r.setHeader("Content-Type","application/javascript; charset=UTF-8");r.writeHead(200);n=function(e){return function(e){var t;try{return r.write(e+"\n")}catch(e){t=e}}}(this);e.timeout_chain([[0,function(e){return function(){return n("h")}}(this)],[1,function(e){return function(){return n(Array(2049).join(" ")+"h")}}(this)],[5,function(e){return function(){return n("h")}}(this)],[25,function(e){return function(){return n("h")}}(this)],[125,function(e){return function(){return n("h")}}(this)],[625,function(e){return function(){return n("h")}}(this)],[3125,function(e){return function(){n("h");return r.end()}}(this)]]);return true},info:function(t,r,s){var i;i={websocket:this.options.websocket,origins:!this.options.disable_cors?["*:*"]:void 0,cookie_needed:!!this.options.jsessionid,entropy:e.random32()};if(typeof this.options.base_url==="function"){i.base_url=this.options.base_url()}else if(this.options.base_url){i.base_url=this.options.base_url}r.setHeader("Content-Type","application/json; charset=UTF-8");r.writeHead(200);return r.end(JSON.stringify(i))},info_options:function(e,t){t.statusCode=204;t.setHeader("Access-Control-Allow-Methods","OPTIONS, GET");t.setHeader("Access-Control-Max-Age",t.cache_for);return""}}}).call(this)},668:function(e,t,r){(function(){var e,s;s=r(2120);e='<!DOCTYPE html>\n<html>\n<head>\n  <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n  <script src="{{ sockjs_url }}"><\/script>\n  <script>\n    document.domain = document.domain;\n    SockJS.bootstrap_iframe();\n  <\/script>\n</head>\n<body>\n  <h2>Don\'t panic!</h2>\n  <p>This is a SockJS hidden iframe. It\'s used for cross domain magic.</p>\n</body>\n</html>';t.app={iframe:function(t,r){var i,n,o,a;n={"{{ sockjs_url }}":this.options.sockjs_url};i=e;for(o in n){i=i.replace(o,n[o])}a='"'+s.md5_hex(i)+'"';if("if-none-match"in t.headers&&t.headers["if-none-match"]===a){r.statusCode=304;return""}r.setHeader("Content-Type","text/html; charset=UTF-8");r.setHeader("ETag",a);return i}}}).call(this)},6809:function(e,t,r){(function(){var e,s,i,n,o,a,h,c,u,f,p,l,d,_,v,g,extend=function(e,t){for(var r in t){if(y.call(t,r))e[r]=t[r]}function ctor(){this.constructor=e}ctor.prototype=t.prototype;e.prototype=new ctor;e.__super__=t.prototype;return e},y={}.hasOwnProperty,bind=function(e,t){return function(){return e.apply(t,arguments)}};o=r(8614);a=r(5747);g=r(8938);v=r(2120);d=r(4561);l=r(1996);_=r(3194);c=r(668);f=r(1831);p=r(4509);n=r(4237);u=function(){var e,t;try{e=a.readFileSync(r.ab+"package.json","utf-8")}catch(e){t=e}if(e){return JSON.parse(e).version}else{return null}};e=function(e){extend(App,e);function App(){return App.__super__.constructor.apply(this,arguments)}App.prototype.welcome_screen=function(e,t){t.setHeader("content-type","text/plain; charset=UTF-8");t.writeHead(200);t.end("Welcome to SockJS!\n");return true};App.prototype.handle_404=function(e,t){t.setHeader("content-type","text/plain; charset=UTF-8");t.writeHead(404);t.end("404 Error: Page not found\n");return true};App.prototype.disabled_transport=function(e,t,r){return this.handle_404(e,t,r)};App.prototype.h_sid=function(e,t,r){var s;e.cookies=v.parseCookie(e.headers.cookie);if(typeof this.options.jsessionid==="function"){this.options.jsessionid(e,t)}else if(this.options.jsessionid&&t.setHeader){s=e.cookies["JSESSIONID"]||"dummy";t.setHeader("Set-Cookie","JSESSIONID="+s+"; path=/")}return r};App.prototype.log=function(e,t){return this.options.log(e,t)};return App}(g.GenericApp);v.objectExtend(e.prototype,c.app);v.objectExtend(e.prototype,n.app);v.objectExtend(e.prototype,d.app);v.objectExtend(e.prototype,l.app);v.objectExtend(e.prototype,_.app);v.objectExtend(e.prototype,f.app);v.objectExtend(e.prototype,p.app);h=function(e){var t,r,s,i,n;r=function(t){return function(t){return new RegExp("^"+e.prefix+t+"[/]?$")}}(this);i=function(e){return function(e){return[r("/([^/.]+)/([^/.]+)"+e),"server","session"]}}(this);t=function(e){if(e==null){e="xhr_options"}return["h_sid","xhr_cors","cache_for",e,"expose"]};s=[["GET",r(""),["welcome_screen"]],["GET",r("/iframe[0-9-.a-z_]*.html"),["iframe","cache_for","expose"]],["OPTIONS",r("/info"),t("info_options")],["GET",r("/info"),["xhr_cors","h_no_cache","info","expose"]],["OPTIONS",r("/chunking_test"),t()],["POST",r("/chunking_test"),["xhr_cors","expect_xhr","chunking_test"]]];n=[["GET",i("/jsonp"),["h_sid","h_no_cache","jsonp"]],["POST",i("/jsonp_send"),["h_sid","h_no_cache","expect_form","jsonp_send"]],["POST",i("/xhr"),["h_sid","h_no_cache","xhr_cors","xhr_poll"]],["OPTIONS",i("/xhr"),t()],["POST",i("/xhr_send"),["h_sid","h_no_cache","xhr_cors","expect_xhr","xhr_send"]],["OPTIONS",i("/xhr_send"),t()],["POST",i("/xhr_streaming"),["h_sid","h_no_cache","xhr_cors","xhr_streaming"]],["OPTIONS",i("/xhr_streaming"),t()],["GET",i("/eventsource"),["h_sid","h_no_cache","eventsource"]],["GET",i("/htmlfile"),["h_sid","h_no_cache","htmlfile"]]];if(e.websocket){s.push(["GET",r("/websocket"),["raw_websocket"]]);n.push(["GET",i("/websocket"),["sockjs_websocket"]])}else{s.push(["GET",r("/websocket"),["cache_for","disabled_transport"]]);n.push(["GET",i("/websocket"),["cache_for","disabled_transport"]])}return s.concat(n)};s=function(){function Listener(t,r){this.options=t;this.handler=bind(this.handler,this);this.app=new e;this.app.options=this.options;this.app.emit=r;this.app.log("debug","SockJS v"+u()+" "+"bound to "+JSON.stringify(this.options.prefix));this.dispatcher=h(this.options);this.webjs_handler=g.generateHandler(this.app,this.dispatcher);this.path_regexp=new RegExp("^"+this.options.prefix+"([/].+|[/]?)$")}Listener.prototype.handler=function(e,t,r){if(!e.url.match(this.path_regexp)){return false}this.webjs_handler(e,t,r);return true};Listener.prototype.getHandler=function(){return function(e){return function(t,r,s){return e.handler(t,r,s)}}(this)};return Listener}();i=function(e){extend(Server,e);function Server(e){this.options={prefix:"",response_limit:128*1024,websocket:true,faye_server_options:null,jsessionid:false,heartbeat_delay:25e3,disconnect_delay:5e3,log:function(e,t){return console.log(t)},sockjs_url:"https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"};if(e){v.objectExtend(this.options,e)}}Server.prototype.listener=function(e){var t;t=v.objectExtend({},this.options);if(e){v.objectExtend(t,e)}return new s(t,function(e){return function(){return e.emit.apply(e,arguments)}}(this))};Server.prototype.installHandlers=function(e,t){var r;r=this.listener(t).getHandler();v.overshadowListeners(e,"request",r);v.overshadowListeners(e,"upgrade",r);return true};Server.prototype.middleware=function(e){var t;t=this.listener(e).getHandler();t.upgrade=t;return t};return Server}(o.EventEmitter);t.createServer=function(e){return new i(e)};t.listen=function(e,r){var s;s=t.createServer(r);if(e){s.installHandlers(e)}return s}}).call(this)},1831:function(e,t,r){(function(){var e,s,i,extend=function(e,t){for(var r in t){if(n.call(t,r))e[r]=t[r]}function ctor(){this.constructor=e}ctor.prototype=t.prototype;e.prototype=new ctor;e.__super__=t.prototype;return e},n={}.hasOwnProperty;i=r(2120);s=r(3752);e=function(e){extend(EventSourceReceiver,e);function EventSourceReceiver(){return EventSourceReceiver.__super__.constructor.apply(this,arguments)}EventSourceReceiver.prototype.protocol="eventsource";EventSourceReceiver.prototype.doSendFrame=function(e){var t;t=["data: ",i.escape_selected(e,"\r\n\0"),"\r\n\r\n"];return EventSourceReceiver.__super__.doSendFrame.call(this,t.join(""))};return EventSourceReceiver}(s.ResponseReceiver);t.app={eventsource:function(t,r){var i,n;if(!t.headers["origin"]||t.headers["origin"]==="null"){n="*"}else{n=t.headers["origin"];r.setHeader("Access-Control-Allow-Credentials","true")}r.setHeader("Content-Type","text/event-stream");r.setHeader("Access-Control-Allow-Origin",n);r.setHeader("Vary","Origin");i=t.headers["access-control-request-headers"];if(i){r.setHeader("Access-Control-Allow-Headers",i)}r.writeHead(200);r.write("\r\n");s.register(t,this,new e(t,r,this.options));return true}}}).call(this)},4509:function(e,t,r){(function(){var e,s,i,n,extend=function(e,t){for(var r in t){if(o.call(t,r))e[r]=t[r]}function ctor(){this.constructor=e}ctor.prototype=t.prototype;e.prototype=new ctor;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=r(2120);i=r(3752);s='<!doctype html>\n<html><head>\n  <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n</head><body><h2>Don\'t panic!</h2>\n  <script>\n    document.domain = document.domain;\n    var c = parent.{{ callback }};\n    c.start();\n    function p(d) {c.message(d);};\n    window.onload = function() {c.stop();};\n  <\/script>';s+=Array(1024-s.length+14).join(" ");s+="\r\n\r\n";e=function(e){extend(HtmlFileReceiver,e);function HtmlFileReceiver(){return HtmlFileReceiver.__super__.constructor.apply(this,arguments)}HtmlFileReceiver.prototype.protocol="htmlfile";HtmlFileReceiver.prototype.doSendFrame=function(e){return HtmlFileReceiver.__super__.doSendFrame.call(this,"<script>\np("+JSON.stringify(e)+");\n<\/script>\r\n")};return HtmlFileReceiver}(i.ResponseReceiver);t.app={htmlfile:function(t,r){var n;if(!("c"in t.query||"callback"in t.query)){throw{status:500,message:'"callback" parameter required'}}n="c"in t.query?t.query["c"]:t.query["callback"];if(/[^a-zA-Z0-9-_.]/.test(n)){throw{status:500,message:'invalid "callback" parameter'}}r.setHeader("Content-Type","text/html; charset=UTF-8");r.writeHead(200);r.write(s.replace(/{{ callback }}/g,n));i.register(t,this,new e(t,r,this.options));return true}}}).call(this)},1996:function(e,t,r){(function(){var e,s,extend=function(e,t){for(var r in t){if(i.call(t,r))e[r]=t[r]}function ctor(){this.constructor=e}ctor.prototype=t.prototype;e.prototype=new ctor;e.__super__=t.prototype;return e},i={}.hasOwnProperty;s=r(3752);e=function(e){extend(JsonpReceiver,e);JsonpReceiver.prototype.protocol="jsonp-polling";JsonpReceiver.prototype.max_response_size=1;function JsonpReceiver(e,t,r,s){this.callback=s;JsonpReceiver.__super__.constructor.call(this,e,t,r)}JsonpReceiver.prototype.doSendFrame=function(e){return JsonpReceiver.__super__.doSendFrame.call(this,"/**/"+this.callback+"("+JSON.stringify(e)+");\r\n")};return JsonpReceiver}(s.ResponseReceiver);t.app={jsonp:function(t,r,i,n){var o;if(!("c"in t.query||"callback"in t.query)){throw{status:500,message:'"callback" parameter required'}}o="c"in t.query?t.query["c"]:t.query["callback"];if(/[^a-zA-Z0-9-_.]/.test(o)||o.length>32){throw{status:500,message:'invalid "callback" parameter'}}r.setHeader("X-Content-Type-Options","nosniff");r.setHeader("Content-Type","application/javascript; charset=UTF-8");r.writeHead(200);s.register(t,this,new e(t,r,this.options,o));return true},jsonp_send:function(e,t,r){var i,n,o,a,h,c;if(!r){throw{status:500,message:"Payload expected."}}if(typeof r==="string"){try{i=JSON.parse(r)}catch(e){c=e;throw{status:500,message:"Broken JSON encoding."}}}else{i=r.d}if(typeof i==="string"&&i){try{i=JSON.parse(i)}catch(e){c=e;throw{status:500,message:"Broken JSON encoding."}}}if(!i||i.__proto__.constructor!==Array){throw{status:500,message:"Payload expected."}}o=s.Session.bySessionId(e.session);if(o===null){throw{status:404}}for(n=0,a=i.length;n<a;n++){h=i[n];o.didMessage(h)}t.setHeader("Content-Length","2");t.setHeader("Content-Type","text/plain; charset=UTF-8");t.writeHead(200);t.end("ok");return true}}}).call(this)},4561:function(e,t,r){(function(){var e,s,i,n,o,a,extend=function(e,t){for(var r in t){if(h.call(t,r))e[r]=t[r]}function ctor(){this.constructor=e}ctor.prototype=t.prototype;e.prototype=new ctor;e.__super__=t.prototype;return e},h={}.hasOwnProperty;e=r(2178);a=r(2120);o=r(3752);t.app={_websocket_check:function(t,r,s){if(!e.isWebSocket(t)){throw{status:400,message:"Not a valid websocket request"}}},sockjs_websocket:function(t,r,s){var i;this._websocket_check(t,r,s);i=new e(t,r,s,null,this.options.faye_server_options);i.onopen=function(e){return function(){return o.registerNoSession(t,e,new n(i,r))}}(this);return true},raw_websocket:function(t,r,i){var n,o;this._websocket_check(t,r,i);n=t.headers["sec-websocket-version"]||"";if(["8","13"].indexOf(n)===-1){throw{status:400,message:"Only supported WebSocket protocol is RFC 6455."}}o=new e(t,r,i,null,this.options.faye_server_options);o.onopen=function(e){return function(){return new s(t,r,e,o)}}(this);return true}};n=function(e){extend(WebSocketReceiver,e);WebSocketReceiver.prototype.protocol="websocket";function WebSocketReceiver(e,t){var r;this.ws=e;this.connection=t;try{this.connection.setKeepAlive(true,5e3);this.connection.setNoDelay(true)}catch(e){r=e}this.ws.addEventListener("message",function(e){return function(t){return e.didMessage(t.data)}}(this));this.heartbeat_cb=function(e){return function(){return e.heartbeat_timeout()}}(this);WebSocketReceiver.__super__.constructor.call(this,this.connection)}WebSocketReceiver.prototype.setUp=function(){WebSocketReceiver.__super__.setUp.apply(this,arguments);return this.ws.addEventListener("close",this.thingy_end_cb)};WebSocketReceiver.prototype.tearDown=function(){this.ws.removeEventListener("close",this.thingy_end_cb);return WebSocketReceiver.__super__.tearDown.apply(this,arguments)};WebSocketReceiver.prototype.didMessage=function(e){var t,r,s,i,n,o;if(this.ws&&this.session&&e.length>0){try{s=JSON.parse(e)}catch(e){o=e;return this.didClose(3e3,"Broken framing.")}if(e[0]==="["){n=[];for(t=0,r=s.length;t<r;t++){i=s[t];n.push(this.session.didMessage(i))}return n}else{return this.session.didMessage(s)}}};WebSocketReceiver.prototype.doSendFrame=function(e){var t;if(this.ws){try{this.ws.send(e);return true}catch(e){t=e}}return false};WebSocketReceiver.prototype.didClose=function(e,t){var r;if(e==null){e=1e3}if(t==null){t="Normal closure"}WebSocketReceiver.__super__.didClose.apply(this,arguments);try{this.ws.close(e,t,false)}catch(e){r=e}this.ws=null;return this.connection=null};WebSocketReceiver.prototype.heartbeat=function(){var e,t;t=this.ws.ping(null,(function(){return clearTimeout(e)}));if(t){return e=setTimeout(this.heartbeat_cb,1e4)}else{return WebSocketReceiver.__super__.heartbeat.apply(this,arguments)}};WebSocketReceiver.prototype.heartbeat_timeout=function(){if(this.session!=null){return this.session.close(3e3,"No response from heartbeat")}};return WebSocketReceiver}(o.GenericReceiver);i=o.Transport;s=function(e){extend(RawWebsocketSessionReceiver,e);function RawWebsocketSessionReceiver(e,t,r,s){this.ws=s;this.prefix=r.options.prefix;this.readyState=i.OPEN;this.recv={connection:t,protocol:"websocket-raw"};this.connection=new o.SockJSConnection(this);this.decorateConnection(e);r.emit("connection",this.connection);this._end_cb=function(e){return function(){return e.didClose()}}(this);this.ws.addEventListener("close",this._end_cb);this._message_cb=function(e){return function(t){return e.didMessage(t)}}(this);this.ws.addEventListener("message",this._message_cb)}RawWebsocketSessionReceiver.prototype.didMessage=function(e){if(this.readyState===i.OPEN){this.connection.emit("data",e.data)}};RawWebsocketSessionReceiver.prototype.send=function(e){if(this.readyState!==i.OPEN){return false}this.ws.send(e);return true};RawWebsocketSessionReceiver.prototype.close=function(e,t){if(e==null){e=1e3}if(t==null){t="Normal closure"}if(this.readyState!==i.OPEN){return false}this.readyState=i.CLOSING;this.ws.close(e,t,false);return true};RawWebsocketSessionReceiver.prototype.didClose=function(){var e;if(!this.ws){return}this.ws.removeEventListener("message",this._message_cb);this.ws.removeEventListener("close",this._end_cb);try{this.ws.close(1e3,"Normal closure",false)}catch(t){e=t}this.ws=null;this.readyState=i.CLOSED;this.connection.emit("end");this.connection.emit("close");return this.connection=null};return RawWebsocketSessionReceiver}(o.Session)}).call(this)},3194:function(e,t,r){(function(){var e,s,i,n,extend=function(e,t){for(var r in t){if(o.call(t,r))e[r]=t[r]}function ctor(){this.constructor=e}ctor.prototype=t.prototype;e.prototype=new ctor;e.__super__=t.prototype;return e},o={}.hasOwnProperty;i=r(3752);n=r(2120);s=function(e){extend(XhrStreamingReceiver,e);function XhrStreamingReceiver(){return XhrStreamingReceiver.__super__.constructor.apply(this,arguments)}XhrStreamingReceiver.prototype.protocol="xhr-streaming";XhrStreamingReceiver.prototype.doSendFrame=function(e){return XhrStreamingReceiver.__super__.doSendFrame.call(this,e+"\n")};return XhrStreamingReceiver}(i.ResponseReceiver);e=function(e){extend(XhrPollingReceiver,e);function XhrPollingReceiver(){return XhrPollingReceiver.__super__.constructor.apply(this,arguments)}XhrPollingReceiver.prototype.protocol="xhr-polling";XhrPollingReceiver.prototype.max_response_size=1;return XhrPollingReceiver}(s);t.app={xhr_options:function(e,t){t.statusCode=204;t.setHeader("Access-Control-Allow-Methods","OPTIONS, POST");t.setHeader("Access-Control-Max-Age",t.cache_for);return""},xhr_send:function(e,t,r){var s,n,o,a,h,c;if(!r){throw{status:500,message:"Payload expected."}}try{s=JSON.parse(r)}catch(e){c=e;throw{status:500,message:"Broken JSON encoding."}}if(!s||s.__proto__.constructor!==Array){throw{status:500,message:"Payload expected."}}o=i.Session.bySessionId(e.session);if(!o){throw{status:404}}for(n=0,a=s.length;n<a;n++){h=s[n];o.didMessage(h)}t.setHeader("Content-Type","text/plain; charset=UTF-8");t.writeHead(204);t.end();return true},xhr_cors:function(e,t,r){var s,i;if(this.options.disable_cors){return r}if(!e.headers["origin"]){i="*"}else{i=e.headers["origin"];t.setHeader("Access-Control-Allow-Credentials","true")}t.setHeader("Access-Control-Allow-Origin",i);t.setHeader("Vary","Origin");s=e.headers["access-control-request-headers"];if(s){t.setHeader("Access-Control-Allow-Headers",s)}return r},xhr_poll:function(t,r,s,n){r.setHeader("Content-Type","application/javascript; charset=UTF-8");r.writeHead(200);i.register(t,this,new e(t,r,this.options));return true},xhr_streaming:function(e,t,r,n){t.setHeader("Content-Type","application/javascript; charset=UTF-8");t.writeHead(200);t.write(Array(2049).join("h")+"\n");i.register(e,this,new s(e,t,this.options));return true}}}).call(this)},3752:function(e,t,r){(function(){var e,s,i,n,o,a,h,c,u,f,p,extend=function(e,t){for(var r in t){if(l.call(t,r))e[r]=t[r]}function ctor(){this.constructor=e}ctor.prototype=t.prototype;e.prototype=new ctor;e.__super__=t.prototype;return e},l={}.hasOwnProperty;u=r(2413);p=r(7576);f=r(2120);a=function(){function Transport(){}return Transport}();a.CONNECTING=0;a.OPEN=1;a.CLOSING=2;a.CLOSED=3;h=function(e,t){return"c"+JSON.stringify([e,t])};o=function(e){extend(SockJSConnection,e);function SockJSConnection(e){this._session=e;this.id=p();this.headers={};this.prefix=this._session.prefix}SockJSConnection.prototype.toString=function(){return"<SockJSConnection "+this.id+">"};SockJSConnection.prototype.write=function(e){return this._session.send(""+e)};SockJSConnection.prototype.end=function(e){if(e){this.write(e)}this.close();return null};SockJSConnection.prototype.close=function(e,t){return this._session.close(e,t)};SockJSConnection.prototype.destroy=function(){this.end();return this.removeAllListeners()};SockJSConnection.prototype.destroySoon=function(){return this.destroy()};return SockJSConnection}(u.Stream);o.prototype.__defineGetter__("readable",(function(){return this._session.readyState===a.OPEN}));o.prototype.__defineGetter__("writable",(function(){return this._session.readyState===a.OPEN}));o.prototype.__defineGetter__("readyState",(function(){return this._session.readyState}));s={};n=function(){function Session(e,t){this.session_id=e;this.heartbeat_delay=t.options.heartbeat_delay;this.disconnect_delay=t.options.disconnect_delay;this.prefix=t.options.prefix;this.send_buffer=[];this.is_closing=false;this.readyState=a.CONNECTING;if(this.session_id){s[this.session_id]=this}this.timeout_cb=function(e){return function(){return e.didTimeout()}}(this);this.to_tref=setTimeout(this.timeout_cb,this.disconnect_delay);this.connection=new o(this);this.emit_open=function(e){return function(){e.emit_open=null;return t.emit("connection",e.connection)}}(this)}Session.prototype.register=function(e,t){if(this.recv){t.doSendFrame(h(2010,"Another connection still open"));t.didClose();return}if(this.to_tref){clearTimeout(this.to_tref);this.to_tref=null}if(this.readyState===a.CLOSING){this.flushToRecv(t);t.doSendFrame(this.close_frame);t.didClose();this.to_tref=setTimeout(this.timeout_cb,this.disconnect_delay);return}this.recv=t;this.recv.session=this;this.decorateConnection(e);if(this.readyState===a.CONNECTING){this.recv.doSendFrame("o");this.readyState=a.OPEN;process.nextTick(this.emit_open)}if(!this.recv){return}this.tryFlush()};Session.prototype.decorateConnection=function(e){var t,r,s,i,n,o,a,h,c,u;if(!(c=this.recv.connection)){c=this.recv.response.connection}try{a=c.remoteAddress;h=c.remotePort;t=c.address()}catch(e){u=e}if(a){this.connection.remoteAddress=a;this.connection.remotePort=h;this.connection.address=t}this.connection.url=e.url;this.connection.pathname=e.pathname;this.connection.protocol=this.recv.protocol;r={};o=["referer","x-client-ip","x-forwarded-for","x-forwarded-host","x-forwarded-port","x-cluster-client-ip","via","x-real-ip","x-forwarded-proto","x-ssl","dnt","host","user-agent","accept-language"];for(s=0,n=o.length;s<n;s++){i=o[s];if(e.headers[i]){r[i]=e.headers[i]}}if(r){return this.connection.headers=r}};Session.prototype.unregister=function(){var e;e=this.recv.delay_disconnect;this.recv.session=null;this.recv=null;if(this.to_tref){clearTimeout(this.to_tref)}if(e){return this.to_tref=setTimeout(this.timeout_cb,this.disconnect_delay)}else{return this.timeout_cb()}};Session.prototype.flushToRecv=function(e){var t,r;if(this.send_buffer.length>0){t=[this.send_buffer,[]],r=t[0],this.send_buffer=t[1];e.doSendBulk(r);return true}return false};Session.prototype.tryFlush=function(){var e;if(!this.flushToRecv(this.recv)||!this.to_tref){if(this.to_tref){clearTimeout(this.to_tref)}e=function(t){return function(){if(t.recv){t.to_tref=setTimeout(e,t.heartbeat_delay);return t.recv.heartbeat()}}}(this);this.to_tref=setTimeout(e,this.heartbeat_delay)}};Session.prototype.didTimeout=function(){if(this.to_tref){clearTimeout(this.to_tref);this.to_tref=null}if(this.readyState!==a.CONNECTING&&this.readyState!==a.OPEN&&this.readyState!==a.CLOSING){throw Error("INVALID_STATE_ERR")}if(this.recv){throw Error("RECV_STILL_THERE")}this.readyState=a.CLOSED;this.connection.emit("end");this.connection.emit("close");this.connection=null;if(this.session_id){delete s[this.session_id];return this.session_id=null}};Session.prototype.didMessage=function(e){if(this.readyState===a.OPEN){this.connection.emit("data",e)}};Session.prototype.send=function(e){if(this.readyState!==a.OPEN){return false}this.send_buffer.push(""+e);if(this.recv){this.tryFlush()}return true};Session.prototype.close=function(e,t){if(e==null){e=1e3}if(t==null){t="Normal closure"}if(this.readyState!==a.OPEN){return false}this.readyState=a.CLOSING;this.close_frame=h(e,t);if(this.recv){this.recv.doSendFrame(this.close_frame);if(this.recv){this.recv.didClose()}if(this.recv){this.unregister()}}return true};return Session}();n.bySessionId=function(e){if(!e){return null}return s[e]||null};c=function(e,t,r,s){var i;i=n.bySessionId(r);if(!i){i=new n(r,t)}i.register(e,s);return i};t.register=function(e,t,r){return c(e,t,e.session,r)};t.registerNoSession=function(e,t,r){return c(e,t,void 0,r)};e=function(){function GenericReceiver(e){this.thingy=e;this.setUp(this.thingy)}GenericReceiver.prototype.setUp=function(){this.thingy_end_cb=function(e){return function(){return e.didAbort()}}(this);this.thingy.addListener("close",this.thingy_end_cb);return this.thingy.addListener("end",this.thingy_end_cb)};GenericReceiver.prototype.tearDown=function(){this.thingy.removeListener("close",this.thingy_end_cb);this.thingy.removeListener("end",this.thingy_end_cb);return this.thingy_end_cb=null};GenericReceiver.prototype.didAbort=function(){this.delay_disconnect=false;return this.didClose()};GenericReceiver.prototype.didClose=function(){if(this.thingy){this.tearDown(this.thingy);this.thingy=null}if(this.session){return this.session.unregister()}};GenericReceiver.prototype.doSendBulk=function(e){var t,r;r=function(){var r,s,i;i=[];for(r=0,s=e.length;r<s;r++){t=e[r];i.push(f.quote(t))}return i}();return this.doSendFrame("a"+"["+r.join(",")+"]")};GenericReceiver.prototype.heartbeat=function(){return this.doSendFrame("h")};return GenericReceiver}();i=function(e){extend(ResponseReceiver,e);ResponseReceiver.prototype.max_response_size=void 0;ResponseReceiver.prototype.delay_disconnect=true;function ResponseReceiver(e,t,r){var s;this.request=e;this.response=t;this.options=r;this.curr_response_size=0;try{this.request.connection.setKeepAlive(true,5e3)}catch(e){s=e}ResponseReceiver.__super__.constructor.call(this,this.request.connection);if(this.max_response_size===void 0){this.max_response_size=this.options.response_limit}}ResponseReceiver.prototype.doSendFrame=function(e){var t,r;this.curr_response_size+=e.length;t=false;try{this.response.write(e);t=true}catch(e){r=e}if(this.max_response_size&&this.curr_response_size>=this.max_response_size){this.didClose()}return t};ResponseReceiver.prototype.didClose=function(){var e;ResponseReceiver.__super__.didClose.apply(this,arguments);try{this.response.end()}catch(t){e=t}return this.response=null};return ResponseReceiver}(e);t.GenericReceiver=e;t.Transport=a;t.Session=n;t.ResponseReceiver=i;t.SockJSConnection=o}).call(this)},2120:function(e,t,r){(function(){var e,s,i,n,o;s=r(6417);t.array_intersection=e=function(e,t){var r,s,i,n;n=[];for(s=0,i=e.length;s<i;s++){r=e[s];if(t.indexOf(r)!==-1){n.push(r)}}return n};t.escape_selected=function(e,t){var r,s,i,n,o,a,h,c,u,f;a={};t="%"+t;for(i=0,o=t.length;i<o;i++){r=t[i];a[r]=escape(r)}c=new RegExp("(["+t+"])");h=e.split(c);for(s=n=0,u=h.length;0<=u?n<u:n>u;s=0<=u?++n:--n){f=h[s];if(f.length===1&&f in a){h[s]=a[f]}}return h.join("")};t.buffer_concat=function(e,t){var r;r=new Buffer(e.length+t.length);e.copy(r);t.copy(r,e.length);return r};t.md5_hex=function(e){return s.createHash("md5").update(e).digest("hex")};t.sha1_base64=function(e){return s.createHash("sha1").update(e).digest("base64")};t.timeout_chain=function(e){var r,s,i,n;e=e.slice(0);if(!e.length){return}s=e.shift(),i=s[0],n=s[1];r=function(r){return function(){n();return t.timeout_chain(e)}}(this);return setTimeout(r,i)};t.objectExtend=function(e,t){var r;for(r in t){if(t.hasOwnProperty(r)){e[r]=t[r]}}return e};t.overshadowListeners=function(e,t,r){var s,i;i=e.listeners(t).slice(0);e.removeAllListeners(t);s=function(){var e,t,s;if(r.apply(this,arguments)!==true){for(e=0,t=i.length;e<t;e++){s=i[e];s.apply(this,arguments)}return false}return true};return e.addListener(t,s)};i=/[\x00-\x1f\ud800-\udfff\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufff0-\uffff]/g;o=function(e){var t,r,s;s={};t=function(){var e,t;t=[];for(r=e=0;e<65536;r=++e){t.push(String.fromCharCode(r))}return t}();e.lastIndex=0;t.join("").replace(e,(function(e){return s[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));return s};n=o(i);t.quote=function(e){var t;t=JSON.stringify(e);i.lastIndex=0;if(!i.test(t)){return t}return t.replace(i,(function(e){return n[e]}))};t.parseCookie=function(e){var t,r,s,i,n,o;r={};if(e){o=e.split(";");for(s=0,i=o.length;s<i;s++){t=o[s];n=t.split("=");r[n[0].trim()]=(n[1]||"").trim()}}return r};t.random32=function(){var e,t;e=s.randomBytes(4);t=[e[0],e[1],e[2],e[3]];return t[0]+t[1]*256+t[2]*256*256+t[3]*256*256*256}}).call(this)},8938:function(e,t,r){(function(){var e,s,i,n,o,a,h,c;h=r(8835);a=r(1191);n=r(5747);o=r(8605);c=r(2120);s=function(e,t,r,s,i){var n,o,a;try{o=[];while(t.length>0){n=t.shift();r.last_fun=n;o.push(i=e[n](r,s,i,r.next_filter))}return o}catch(t){a=t;if(typeof a==="object"&&"status"in a){if(a.status===0){return}else if("handle_"+a.status in e){e["handle_"+a.status](r,s,a)}else{e["handle_error"](r,s,a)}}else{e["handle_error"](r,s,a)}return e["log_request"](r,s,true)}};i=function(e,t){var r;r={Connection:"close"};t.writeHead=function(s,i){var n,a,h;if(i==null){i={}}a=[];a.push("HTTP/"+e.httpVersion+" "+s+" "+o.STATUS_CODES[s]);c.objectExtend(r,i);for(n in r){a.push(n+": "+r[n])}a=a.concat(["",""]);try{return t.write(a.join("\r\n"))}catch(e){h=e}};return t.setHeader=function(e,t){return r[e]=t}};t.generateHandler=function(e,t){return function(r,n,o){var a,u,f,p,l,d,_,v,g,y,m,S;if(typeof n.writeHead==="undefined"){i(r,n)}c.objectExtend(r,h.parse(r.url,true));r.start_date=new Date;u=false;a=[];for(l=0,_=t.length;l<_;l++){S=t[l];g=S[0],y=S[1],f=S[2];if(y.constructor!==Array){y=[y]}v=r.pathname.match(y[0]);if(!v){continue}if(!r.method.match(new RegExp(g))){a.push(g);continue}for(p=d=1,m=y.length;1<=m?d<m:d>m;p=1<=m?++d:--d){r[y[p]]=v[p]}f=f.slice(0);f.push("log_request");r.next_filter=function(t){return s(e,f,r,n,t)};r.next_filter(o);u=true;break}if(!u){if(a.length!==0){e["handle_405"](r,n,a)}else{e["handle_404"](r,n)}e["log_request"](r,n,true)}}};t.GenericApp=e=function(){function GenericApp(){}GenericApp.prototype.handle_404=function(e,t,r){if(t.finished){return r}t.writeHead(404,{});t.end();return true};GenericApp.prototype.handle_405=function(e,t,r){t.writeHead(405,{Allow:r.join(", ")});t.end();return true};GenericApp.prototype.handle_error=function(e,t,r){if(t.finished){return r}if(typeof r==="object"&&"status"in r){t.writeHead(r.status,{});t.end(r.message||"")}else{try{t.writeHead(500,{});t.end("500 - Internal Server Error")}catch(e){r=e}this.log("error",'Exception on "'+e.method+" "+e.href+'" in filter "'+e.last_fun+'":\n'+(r.stack||r))}return true};GenericApp.prototype.log_request=function(e,t,r){var s;s=new Date-e.start_date;this.log("info",e.method+" "+e.url+" "+s+"ms "+(t.finished?t.statusCode:"(unfinished)"));return r};GenericApp.prototype.log=function(e,t){return console.log(t)};GenericApp.prototype.expose_html=function(e,t,r){if(t.finished){return r}if(!t.getHeader("Content-Type")){t.setHeader("Content-Type","text/html; charset=UTF-8")}return this.expose(e,t,r)};GenericApp.prototype.expose_json=function(e,t,r){if(t.finished){return r}if(!t.getHeader("Content-Type")){t.setHeader("Content-Type","application/json")}return this.expose(e,t,JSON.stringify(r))};GenericApp.prototype.expose=function(e,t,r){if(t.finished){return r}if(r&&!t.getHeader("Content-Type")){t.setHeader("Content-Type","text/plain")}if(r){t.setHeader("Content-Length",r.length)}t.writeHead(t.statusCode);t.end(r,"utf8");return true};GenericApp.prototype.serve_file=function(e,t,r,s){var i;i=function(e,r){if(e){t.writeHead(500);t.end("can't read file")}else{t.setHeader("Content-length",r.length);t.writeHead(t.statusCode,t.headers);t.end(r,"utf8")}return s(true)};n.readFile(r,i);throw{status:0}};GenericApp.prototype.cache_for=function(e,t,r){var s;t.cache_for=t.cache_for||365*24*60*60;t.setHeader("Cache-Control","public, max-age="+t.cache_for);s=new Date;s.setTime(s.getTime()+t.cache_for*1e3);t.setHeader("Expires",s.toGMTString());return r};GenericApp.prototype.h_no_cache=function(e,t,r){t.setHeader("Cache-Control","no-store, no-cache, no-transform, must-revalidate, max-age=0");return r};GenericApp.prototype.expect_form=function(e,t,r,s){var i;i=new Buffer(0);e.on("data",function(e){return function(e){return i=c.buffer_concat(i,new Buffer(e,"binary"))}}(this));e.on("end",function(t){return function(){var r;i=i.toString("utf-8");switch((e.headers["content-type"]||"").split(";")[0]){case"application/x-www-form-urlencoded":r=a.parse(i);break;case"text/plain":case"":r=i;break;default:t.log("error","Unsupported content-type "+e.headers["content-type"]);r=void 0}return s(r)}}(this));throw{status:0}};GenericApp.prototype.expect_xhr=function(e,t,r,s){var i;i=new Buffer(0);e.on("data",function(e){return function(e){return i=c.buffer_concat(i,new Buffer(e,"binary"))}}(this));e.on("end",function(t){return function(){var r;i=i.toString("utf-8");switch((e.headers["content-type"]||"").split(";")[0]){case"text/plain":case"T":case"application/json":case"application/xml":case"":case"text/xml":r=i;break;default:t.log("error","Unsupported content-type "+e.headers["content-type"]);r=void 0}return s(r)}}(this));throw{status:0}};return GenericApp}()}).call(this)},3042:e=>{var t=[];for(var r=0;r<256;++r){t[r]=(r+256).toString(16).substr(1)}function bytesToUuid(e,r){var s=r||0;var i=t;return[i[e[s++]],i[e[s++]],i[e[s++]],i[e[s++]],"-",i[e[s++]],i[e[s++]],"-",i[e[s++]],i[e[s++]],"-",i[e[s++]],i[e[s++]],"-",i[e[s++]],i[e[s++]],i[e[s++]],i[e[s++]],i[e[s++]],i[e[s++]]].join("")}e.exports=bytesToUuid},8074:(e,t,r)=>{var s=r(6417);e.exports=function nodeRNG(){return s.randomBytes(16)}},7576:(e,t,r)=>{var s=r(8074);var i=r(3042);function v4(e,t,r){var n=t&&r||0;if(typeof e=="string"){t=e==="binary"?new Array(16):null;e=null}e=e||{};var o=e.random||(e.rng||s)();o[6]=o[6]&15|64;o[8]=o[8]&63|128;if(t){for(var a=0;a<16;++a){t[n+a]=o[a]}}return t||i(o)}e.exports=v4},3436:(e,t,r)=>{"use strict";var s=r(5062),i=r(4199),n=r(3985);var o={client:function(e,t){t=t||{};if(t.masking===undefined)t.masking=true;return new i(e,t)},server:function(e){e=e||{};if(e.requireMasking===undefined)e.requireMasking=true;return new n(e)},http:function(){return n.http.apply(n,arguments)},isSecureRequest:function(e){return n.isSecureRequest(e)},isWebSocket:function(e){return s.isWebSocket(e)},validateOptions:function(e,t){s.validateOptions(e,t)}};e.exports=o},5062:(e,t,r)=>{"use strict";var s=r(3118).Buffer,i=r(8614).EventEmitter,n=r(1669),o=r(7969),a=r(8642),h=r(9605);var Base=function(e,t,r){i.call(this);Base.validateOptions(r||{},["maxLength","masking","requireMasking","protocols"]);this._request=e;this._reader=new h;this._options=r||{};this._maxLength=this._options.maxLength||this.MAX_LENGTH;this._headers=new a;this.__queue=[];this.readyState=0;this.url=t;this.io=new o.IO(this);this.messages=new o.Messages(this);this._bindEventListeners()};n.inherits(Base,i);Base.isWebSocket=function(e){var t=e.headers.connection||"",r=e.headers.upgrade||"";return e.method==="GET"&&t.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&r.toLowerCase()==="websocket"};Base.validateOptions=function(e,t){for(var r in e){if(t.indexOf(r)<0)throw new Error("Unrecognized option: "+r)}};var c={MAX_LENGTH:67108863,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var e=this;this.messages.on("error",(function(){}));this.on("message",(function(t){var r=e.messages;if(r.readable)r.emit("data",t.data)}));this.on("error",(function(t){var r=e.messages;if(r.readable)r.emit("error",t)}));this.on("close",(function(){var t=e.messages;if(!t.readable)return;t.readable=t.writable=false;t.emit("end")}))},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(e){return false},setHeader:function(e,t){if(this.readyState>0)return false;this._headers.set(e,t);return true},start:function(){if(this.readyState!==0)return false;if(!Base.isWebSocket(this._request))return this._failHandshake(new Error("Not a WebSocket request"));var e;try{e=this._handshakeResponse()}catch(e){return this._failHandshake(e)}this._write(e);if(this._stage!==-1)this._open();return true},_failHandshake:function(e){var t=new a;t.set("Content-Type","text/plain");t.set("Content-Length",s.byteLength(e.message,"utf8"));t=["HTTP/1.1 400 Bad Request",t.toString(),e.message];this._write(s.from(t.join("\r\n"),"utf8"));this._fail("protocol_error",e.message);return false},text:function(e){return this.frame(e)},binary:function(e){return false},ping:function(){return false},pong:function(){return false},close:function(e,t){if(this.readyState!==1)return false;this.readyState=3;this.emit("close",new Base.CloseEvent(null,null));return true},_open:function(){this.readyState=1;this.__queue.forEach((function(e){this.frame.apply(this,e)}),this);this.__queue=[];this.emit("open",new Base.OpenEvent)},_queue:function(e){this.__queue.push(e);return true},_write:function(e){var t=this.io;if(t.readable)t.emit("data",e)},_fail:function(e,t){this.readyState=2;this.emit("error",new Error(t));this.close()}};for(var u in c)Base.prototype[u]=c[u];Base.ConnectEvent=function(){};Base.OpenEvent=function(){};Base.CloseEvent=function(e,t){this.code=e;this.reason=t};Base.MessageEvent=function(e){this.data=e};Base.PingEvent=function(e){this.data=e};Base.PongEvent=function(e){this.data=e};e.exports=Base},4199:(e,t,r)=>{"use strict";var s=r(3118).Buffer,i=r(6417),n=r(8835),o=r(1669),a=r(8710),h=r(5062),c=r(9722),u=r(4255);var Client=function(e,t){this.version="hybi-"+c.VERSION;c.call(this,null,e,t);this.readyState=-1;this._key=Client.generateKey();this._accept=c.generateAccept(this._key);this._http=new a("response");var r=n.parse(this.url),i=r.auth&&s.from(r.auth,"utf8").toString("base64");if(this.VALID_PROTOCOLS.indexOf(r.protocol)<0)throw new Error(this.url+" is not a valid WebSocket URL");this._pathname=(r.pathname||"/")+(r.search||"");this._headers.set("Host",r.host);this._headers.set("Upgrade","websocket");this._headers.set("Connection","Upgrade");this._headers.set("Sec-WebSocket-Key",this._key);this._headers.set("Sec-WebSocket-Version",c.VERSION);if(this._protocols.length>0)this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", "));if(i)this._headers.set("Authorization","Basic "+i)};o.inherits(Client,c);Client.generateKey=function(){return i.randomBytes(16).toString("base64")};var f={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(e,t){return new u(this,e,t)},start:function(){if(this.readyState!==-1)return false;this._write(this._handshakeRequest());this.readyState=0;return true},parse:function(e){if(this.readyState===3)return;if(this.readyState>0)return c.prototype.parse.call(this,e);this._http.parse(e);if(!this._http.isComplete())return;this._validateHandshake();if(this.readyState===3)return;this._open();this.parse(this._http.body)},_handshakeRequest:function(){var e=this._extensions.generateOffer();if(e)this._headers.set("Sec-WebSocket-Extensions",e);var t="GET "+this._pathname+" HTTP/1.1",r=[t,this._headers.toString(),""];return s.from(r.join("\r\n"),"utf8")},_failHandshake:function(e){e="Error during WebSocket handshake: "+e;this.readyState=3;this.emit("error",new Error(e));this.emit("close",new h.CloseEvent(this.ERRORS.protocol_error,e))},_validateHandshake:function(){this.statusCode=this._http.statusCode;this.headers=this._http.headers;if(this._http.error)return this._failHandshake(this._http.error.message);if(this._http.statusCode!==101)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var e=this._http.headers,t=e["upgrade"]||"",r=e["connection"]||"",s=e["sec-websocket-accept"]||"",i=e["sec-websocket-protocol"]||"";if(t==="")return this._failHandshake("'Upgrade' header is missing");if(t.toLowerCase()!=="websocket")return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(r==="")return this._failHandshake("'Connection' header is missing");if(r.toLowerCase()!=="upgrade")return this._failHandshake("'Connection' header value is not 'Upgrade'");if(s!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");this.protocol=null;if(i!==""){if(this._protocols.indexOf(i)<0)return this._failHandshake("Sec-WebSocket-Protocol mismatch");else this.protocol=i}try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(e){return this._failHandshake(e.message)}}};for(var p in f)Client.prototype[p]=f[p];e.exports=Client},8914:(e,t,r)=>{"use strict";var s=r(3118).Buffer,i=r(5062),n=r(1669);var Draft75=function(e,t,r){i.apply(this,arguments);this._stage=0;this.version="hixie-75";this._headers.set("Upgrade","WebSocket");this._headers.set("Connection","Upgrade");this._headers.set("WebSocket-Origin",this._request.headers.origin);this._headers.set("WebSocket-Location",this.url)};n.inherits(Draft75,i);var o={close:function(){if(this.readyState===3)return false;this.readyState=3;this.emit("close",new i.CloseEvent(null,null));return true},parse:function(e){if(this.readyState>1)return;this._reader.put(e);this._reader.eachByte((function(e){var t;switch(this._stage){case-1:this._body.push(e);this._sendHandshakeBody();break;case 0:this._parseLeadingByte(e);break;case 1:this._length=(e&127)+128*this._length;if(this._closing&&this._length===0){return this.close()}else if((e&128)!==128){if(this._length===0){this._stage=0}else{this._skipped=0;this._stage=2}}break;case 2:if(e===255){this._stage=0;t=s.from(this._buffer).toString("utf8",0,this._buffer.length);this.emit("message",new i.MessageEvent(t))}else{if(this._length){this._skipped+=1;if(this._skipped===this._length)this._stage=0}else{this._buffer.push(e);if(this._buffer.length>this._maxLength)return this.close()}}break}}),this)},frame:function(e){if(this.readyState===0)return this._queue([e]);if(this.readyState>1)return false;if(typeof e!=="string")e=e.toString();var t=s.byteLength(e),r=s.allocUnsafe(t+2);r[0]=0;r.write(e,1);r[r.length-1]=255;this._write(r);return true},_handshakeResponse:function(){var e="HTTP/1.1 101 Web Socket Protocol Handshake",t=[e,this._headers.toString(),""];return s.from(t.join("\r\n"),"utf8")},_parseLeadingByte:function(e){if((e&128)===128){this._length=0;this._stage=1}else{delete this._length;delete this._skipped;this._buffer=[];this._stage=2}}};for(var a in o)Draft75.prototype[a]=o[a];e.exports=Draft75},2631:(e,t,r)=>{"use strict";var s=r(3118).Buffer,i=r(5062),n=r(8914),o=r(6417),a=r(1669);var numberFromKey=function(e){return parseInt((e.match(/[0-9]/g)||[]).join(""),10)};var spacesInKey=function(e){return(e.match(/ /g)||[]).length};var Draft76=function(e,t,r){n.apply(this,arguments);this._stage=-1;this._body=[];this.version="hixie-76";this._headers.clear();this._headers.set("Upgrade","WebSocket");this._headers.set("Connection","Upgrade");this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin);this._headers.set("Sec-WebSocket-Location",this.url)};a.inherits(Draft76,n);var h={BODY_SIZE:8,start:function(){if(!n.prototype.start.call(this))return false;this._started=true;this._sendHandshakeBody();return true},close:function(){if(this.readyState===3)return false;if(this.readyState===1)this._write(s.from([255,0]));this.readyState=3;this.emit("close",new i.CloseEvent(null,null));return true},_handshakeResponse:function(){var e=this._request.headers,t=e["sec-websocket-key1"],r=e["sec-websocket-key2"];if(!t)throw new Error("Missing required header: Sec-WebSocket-Key1");if(!r)throw new Error("Missing required header: Sec-WebSocket-Key2");var i=numberFromKey(t),n=spacesInKey(t),o=numberFromKey(r),a=spacesInKey(r);if(i%n!==0||o%a!==0)throw new Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[i/n,o/a];var h="HTTP/1.1 101 WebSocket Protocol Handshake",e=[h,this._headers.toString(),""];return s.from(e.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var e=o.createHash("md5"),t=s.allocUnsafe(8+this.BODY_SIZE);t.writeUInt32BE(this._keyValues[0],0);t.writeUInt32BE(this._keyValues[1],4);s.from(this._body).copy(t,8,0,this.BODY_SIZE);e.update(t);return s.from(e.digest("binary"),"binary")},_sendHandshakeBody:function(){if(!this._started)return;var e=this._handshakeSignature();if(!e)return;this._write(e);this._stage=0;this._open();if(this._body.length>this.BODY_SIZE)this.parse(this._body.slice(this.BODY_SIZE))},_parseLeadingByte:function(e){if(e!==255)return n.prototype._parseLeadingByte.call(this,e);this._closing=true;this._length=0;this._stage=1}};for(var c in h)Draft76.prototype[c]=h[c];e.exports=Draft76},8642:e=>{"use strict";var Headers=function(){this.clear()};Headers.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"];Headers.prototype.clear=function(){this._sent={};this._lines=[]};Headers.prototype.set=function(e,t){if(t===undefined)return;e=this._strip(e);t=this._strip(t);var r=e.toLowerCase();if(!this._sent.hasOwnProperty(r)||this.ALLOWED_DUPLICATES.indexOf(r)>=0){this._sent[r]=true;this._lines.push(e+": "+t+"\r\n")}};Headers.prototype.toString=function(){return this._lines.join("")};Headers.prototype._strip=function(e){return e.toString().replace(/^ */,"").replace(/ *$/,"")};e.exports=Headers},9722:(e,t,r)=>{"use strict";var s=r(3118).Buffer,i=r(6417),n=r(1669),o=r(6651),a=r(5062),h=r(7101),c=r(3628);var Hybi=function(e,t,r){a.apply(this,arguments);this._extensions=new o;this._stage=0;this._masking=this._options.masking;this._protocols=this._options.protocols||[];this._requireMasking=this._options.requireMasking;this._pingCallbacks={};if(typeof this._protocols==="string")this._protocols=this._protocols.split(/ *, */);if(!this._request)return;var s=this._request.headers["sec-websocket-protocol"],i=this._protocols;if(s!==undefined){if(typeof s==="string")s=s.split(/ *, */);this.protocol=s.filter((function(e){return i.indexOf(e)>=0}))[0]}this.version="hybi-"+Hybi.VERSION};n.inherits(Hybi,a);Hybi.VERSION="13";Hybi.mask=function(e,t,r){if(!t||t.length===0)return e;r=r||0;for(var s=0,i=e.length-r;s<i;s++){e[r+s]=e[r+s]^t[s%4]}return e};Hybi.generateAccept=function(e){var t=i.createHash("sha1");t.update(e+Hybi.GUID);return t.digest("base64")};Hybi.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var u={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(e){this._extensions.add(e);return true},parse:function(e){this._reader.put(e);var t=true;while(t){switch(this._stage){case 0:t=this._reader.read(1);if(t)this._parseOpcode(t[0]);break;case 1:t=this._reader.read(1);if(t)this._parseLength(t[0]);break;case 2:t=this._reader.read(this._frame.lengthBytes);if(t)this._parseExtendedLength(t);break;case 3:t=this._reader.read(4);if(t){this._stage=4;this._frame.maskingKey=t}break;case 4:t=this._reader.read(this._frame.length);if(t){this._stage=0;this._emitFrame(t)}break;default:t=null}}},text:function(e){if(this.readyState>1)return false;return this.frame(e,"text")},binary:function(e){if(this.readyState>1)return false;return this.frame(e,"binary")},ping:function(e,t){if(this.readyState>1)return false;e=e||"";if(t)this._pingCallbacks[e]=t;return this.frame(e,"ping")},pong:function(e){if(this.readyState>1)return false;e=e||"";return this.frame(e,"pong")},close:function(e,t){e=e||"";t=t||this.ERRORS.normal_closure;if(this.readyState<=0){this.readyState=3;this.emit("close",new a.CloseEvent(t,e));return true}else if(this.readyState===1){this.readyState=2;this._extensions.close((function(){this.frame(e,"close",t)}),this);return true}else{return false}},frame:function(e,t,r){if(this.readyState<=0)return this._queue([e,t,r]);if(this.readyState>2)return false;if(e instanceof Array)e=s.from(e);if(typeof e==="number")e=e.toString();var n=new c,o=typeof e==="string",a,u;n.rsv1=n.rsv2=n.rsv3=false;n.opcode=this.OPCODES[t||(o?"text":"binary")];a=o?s.from(e,"utf8"):e;if(r){u=a;a=s.allocUnsafe(2+u.length);a.writeUInt16BE(r,0);u.copy(a,2)}n.data=a;var onMessageReady=function(e){var t=new h;t.final=true;t.rsv1=e.rsv1;t.rsv2=e.rsv2;t.rsv3=e.rsv3;t.opcode=e.opcode;t.masked=!!this._masking;t.length=e.data.length;t.payload=e.data;if(t.masked)t.maskingKey=i.randomBytes(4);this._sendFrame(t)};if(this.MESSAGE_OPCODES.indexOf(n.opcode)>=0)this._extensions.processOutgoingMessage(n,(function(e,t){if(e)return this._fail("extension_error",e.message);onMessageReady.call(this,t)}),this);else onMessageReady.call(this,n);return true},_sendFrame:function(e){var t=e.length,r=t<=125?2:t<=65535?4:10,i=r+(e.masked?4:0),n=s.allocUnsafe(i+t),o=e.masked?this.MASK:0;n[0]=(e.final?this.FIN:0)|(e.rsv1?this.RSV1:0)|(e.rsv2?this.RSV2:0)|(e.rsv3?this.RSV3:0)|e.opcode;if(t<=125){n[1]=o|t}else if(t<=65535){n[1]=o|126;n.writeUInt16BE(t,2)}else{n[1]=o|127;n.writeUInt32BE(Math.floor(t/4294967296),2);n.writeUInt32BE(t%4294967296,6)}e.payload.copy(n,i);if(e.masked){e.maskingKey.copy(n,r);Hybi.mask(n,e.maskingKey,i)}this._write(n)},_handshakeResponse:function(){var e=this._request.headers["sec-websocket-key"],t=this._request.headers["sec-websocket-version"];if(t!==Hybi.VERSION)throw new Error("Unsupported WebSocket version: "+t);if(typeof e!=="string")throw new Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket");this._headers.set("Connection","Upgrade");this._headers.set("Sec-WebSocket-Accept",Hybi.generateAccept(e));if(this.protocol)this._headers.set("Sec-WebSocket-Protocol",this.protocol);var r=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);if(r)this._headers.set("Sec-WebSocket-Extensions",r);var i="HTTP/1.1 101 Switching Protocols",n=[i,this._headers.toString(),""];return s.from(n.join("\r\n"),"utf8")},_shutdown:function(e,t,r){delete this._frame;delete this._message;this._stage=5;var s=this.readyState===1;this.readyState=2;this._extensions.close((function(){if(s)this.frame(t,"close",e);this.readyState=3;if(r)this.emit("error",new Error(t));this.emit("close",new a.CloseEvent(e,t))}),this)},_fail:function(e,t){if(this.readyState>1)return;this._shutdown(this.ERRORS[e],t,true)},_parseOpcode:function(e){var t=[this.RSV1,this.RSV2,this.RSV3].map((function(t){return(e&t)===t}));var r=this._frame=new h;r.final=(e&this.FIN)===this.FIN;r.rsv1=t[0];r.rsv2=t[1];r.rsv3=t[2];r.opcode=e&this.OPCODE;this._stage=1;if(!this._extensions.validFrameRsv(r))return this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+(r.rsv1?1:0)+", reserved2 = "+(r.rsv2?1:0)+", reserved3 = "+(r.rsv3?1:0));if(this.OPCODE_CODES.indexOf(r.opcode)<0)return this._fail("protocol_error","Unrecognized frame opcode: "+r.opcode);if(this.MESSAGE_OPCODES.indexOf(r.opcode)<0&&!r.final)return this._fail("protocol_error","Received fragmented control frame: opcode = "+r.opcode);if(this._message&&this.OPENING_OPCODES.indexOf(r.opcode)>=0)return this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished")},_parseLength:function(e){var t=this._frame;t.masked=(e&this.MASK)===this.MASK;t.length=e&this.LENGTH;if(t.length>=0&&t.length<=125){this._stage=t.masked?3:4;if(!this._checkFrameLength())return}else{this._stage=2;t.lengthBytes=t.length===126?2:8}if(this._requireMasking&&!t.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(e){var t=this._frame;t.length=this._readUInt(e);this._stage=t.masked?3:4;if(this.MESSAGE_OPCODES.indexOf(t.opcode)<0&&t.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+t.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){var e=this._message?this._message.length:0;if(e+this._frame.length>this._maxLength){this._fail("too_large","WebSocket frame length too large");return false}else{return true}},_emitFrame:function(e){var t=this._frame,r=t.payload=Hybi.mask(e,t.maskingKey),s=t.opcode,i,n,o,h,u;delete this._frame;if(s===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(t)}if(s===this.OPCODES.text||s===this.OPCODES.binary){this._message=new c;this._message.pushFrame(t)}if(t.final&&this.MESSAGE_OPCODES.indexOf(s)>=0)return this._emitMessage(this._message);if(s===this.OPCODES.close){n=r.length>=2?r.readUInt16BE(0):null;o=r.length>2?this._encode(r.slice(2)):null;if(!(r.length===0)&&!(n!==null&&n>=this.MIN_RESERVED_ERROR&&n<=this.MAX_RESERVED_ERROR)&&this.ERROR_CODES.indexOf(n)<0)n=this.ERRORS.protocol_error;if(r.length>125||r.length>2&&!o)n=this.ERRORS.protocol_error;this._shutdown(n||this.DEFAULT_ERROR_CODE,o||"")}if(s===this.OPCODES.ping){this.frame(r,"pong");this.emit("ping",new a.PingEvent(r.toString()))}if(s===this.OPCODES.pong){h=this._pingCallbacks;i=this._encode(r);u=h[i];delete h[i];if(u)u();this.emit("pong",new a.PongEvent(r.toString()))}},_emitMessage:function(e){var e=this._message;e.read();delete this._message;this._extensions.processIncomingMessage(e,(function(e,t){if(e)return this._fail("extension_error",e.message);var r=t.data;if(t.opcode===this.OPCODES.text)r=this._encode(r);if(r===null)return this._fail("encoding_error","Could not decode a text frame as UTF-8");else this.emit("message",new a.MessageEvent(r))}),this)},_encode:function(e){try{var t=e.toString("binary",0,e.length);if(!this.UTF8_MATCH.test(t))return null}catch(e){}return e.toString("utf8",0,e.length)},_readUInt:function(e){if(e.length===2)return e.readUInt16BE(0);return e.readUInt32BE(0)*4294967296+e.readUInt32BE(4)}};for(var f in u)Hybi.prototype[f]=u[f];e.exports=Hybi},7101:e=>{"use strict";var Frame=function(){};var t={final:false,rsv1:false,rsv2:false,rsv3:false,opcode:null,masked:false,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var r in t)Frame.prototype[r]=t[r];e.exports=Frame},3628:(e,t,r)=>{"use strict";var s=r(3118).Buffer;var Message=function(){this.rsv1=false;this.rsv2=false;this.rsv3=false;this.opcode=null;this.length=0;this._chunks=[]};var i={read:function(){return this.data=this.data||s.concat(this._chunks,this.length)},pushFrame:function(e){this.rsv1=this.rsv1||e.rsv1;this.rsv2=this.rsv2||e.rsv2;this.rsv3=this.rsv3||e.rsv3;if(this.opcode===null)this.opcode=e.opcode;this._chunks.push(e.payload);this.length+=e.length}};for(var n in i)Message.prototype[n]=i[n];e.exports=Message},4255:(e,t,r)=>{"use strict";var s=r(3118).Buffer,i=r(2413).Stream,n=r(8835),o=r(1669),a=r(5062),h=r(8642),c=r(8710);var u={"ws:":80,"wss:":443};var Proxy=function(e,t,r){this._client=e;this._http=new c("response");this._origin=typeof e.url==="object"?e.url:n.parse(e.url);this._url=typeof t==="object"?t:n.parse(t);this._options=r||{};this._state=0;this.readable=this.writable=true;this._paused=false;this._headers=new h;this._headers.set("Host",this._origin.host);this._headers.set("Connection","keep-alive");this._headers.set("Proxy-Connection","keep-alive");var i=this._url.auth&&s.from(this._url.auth,"utf8").toString("base64");if(i)this._headers.set("Proxy-Authorization","Basic "+i)};o.inherits(Proxy,i);var f={setHeader:function(e,t){if(this._state!==0)return false;this._headers.set(e,t);return true},start:function(){if(this._state!==0)return false;this._state=1;var e=this._origin,t=e.port||u[e.protocol],r="CONNECT "+e.hostname+":"+t+" HTTP/1.1";var i=[r,this._headers.toString(),""];this.emit("data",s.from(i.join("\r\n"),"utf8"));return true},pause:function(){this._paused=true},resume:function(){this._paused=false;this.emit("drain")},write:function(e){if(!this.writable)return false;this._http.parse(e);if(!this._http.isComplete())return!this._paused;this.statusCode=this._http.statusCode;this.headers=this._http.headers;if(this.statusCode===200){this.emit("connect",new a.ConnectEvent)}else{var t="Can't establish a connection to the server at "+this._origin.href;this.emit("error",new Error(t))}this.end();return!this._paused},end:function(e){if(!this.writable)return;if(e!==undefined)this.write(e);this.readable=this.writable=false;this.emit("close");this.emit("end")},destroy:function(){this.end()}};for(var p in f)Proxy.prototype[p]=f[p];e.exports=Proxy},3985:(e,t,r)=>{"use strict";var s=r(1669),i=r(8710),n=r(5062),o=r(8914),a=r(2631),h=r(9722);var Server=function(e){n.call(this,null,null,e);this._http=new i("request")};s.inherits(Server,n);var c={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",(function(){}));this.on("error",(function(){}))},parse:function(e){if(this._delegate)return this._delegate.parse(e);this._http.parse(e);if(!this._http.isComplete())return;this.method=this._http.method;this.url=this._http.url;this.headers=this._http.headers;this.body=this._http.body;var t=this;this._delegate=Server.http(this,this._options);this._delegate.messages=this.messages;this._delegate.io=this.io;this._open();this.EVENTS.forEach((function(e){this._delegate.on(e,(function(r){t.emit(e,r)}))}),this);this.protocol=this._delegate.protocol;this.version=this._delegate.version;this.parse(this._http.body);this.emit("connect",new n.ConnectEvent)},_open:function(){this.__queue.forEach((function(e){this._delegate[e[0]].apply(this._delegate,e[1])}),this);this.__queue=[]}};["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach((function(e){c[e]=function(){if(this._delegate){return this._delegate[e].apply(this._delegate,arguments)}else{this.__queue.push([e,arguments]);return true}}}));for(var u in c)Server.prototype[u]=c[u];Server.isSecureRequest=function(e){if(e.connection&&e.connection.authorized!==undefined)return true;if(e.socket&&e.socket.secure)return true;var t=e.headers;if(!t)return false;if(t["https"]==="on")return true;if(t["x-forwarded-ssl"]==="on")return true;if(t["x-forwarded-scheme"]==="https")return true;if(t["x-forwarded-proto"]==="https")return true;return false};Server.determineUrl=function(e){var t=this.isSecureRequest(e)?"wss:":"ws:";return t+"//"+e.headers.host+e.url};Server.http=function(e,t){t=t||{};if(t.requireMasking===undefined)t.requireMasking=true;var r=e.headers,s=r["sec-websocket-version"],i=r["sec-websocket-key"],n=r["sec-websocket-key1"],c=r["sec-websocket-key2"],u=this.determineUrl(e);if(s||i)return new h(e,u,t);else if(n||c)return new a(e,u,t);else return new o(e,u,t)};e.exports=Server},9605:(e,t,r)=>{"use strict";var s=r(3118).Buffer;var StreamReader=function(){this._queue=[];this._queueSize=0;this._offset=0};StreamReader.prototype.put=function(e){if(!e||e.length===0)return;if(!s.isBuffer(e))e=s.from(e);this._queue.push(e);this._queueSize+=e.length};StreamReader.prototype.read=function(e){if(e>this._queueSize)return null;if(e===0)return s.alloc(0);this._queueSize-=e;var t=this._queue,r=e,i=t[0],n,o;if(i.length>=e){if(i.length===e){return t.shift()}else{o=i.slice(0,e);t[0]=i.slice(e);return o}}for(var a=0,h=t.length;a<h;a++){if(r<t[a].length)break;r-=t[a].length}n=t.splice(0,a);if(r>0&&t.length>0){n.push(t[0].slice(0,r));t[0]=t[0].slice(r)}return s.concat(n,e)};StreamReader.prototype.eachByte=function(e,t){var r,s,i;while(this._queue.length>0){r=this._queue[0];s=r.length;while(this._offset<s){i=this._offset;this._offset+=1;e.call(t,r[i])}this._offset=0;this._queue.shift()}};e.exports=StreamReader},8710:(e,t,r)=>{"use strict";var s=r(508).m,i=r(3118).Buffer;var n={request:s.REQUEST||"request",response:s.RESPONSE||"response"};var HttpParser=function(e){this._type=e;this._parser=new s(n[e]);this._complete=false;this.headers={};var t=null,r=this;this._parser.onHeaderField=function(e,r,s){t=e.toString("utf8",r,r+s).toLowerCase()};this._parser.onHeaderValue=function(e,s,i){var n=e.toString("utf8",s,s+i);if(r.headers.hasOwnProperty(t))r.headers[t]+=", "+n;else r.headers[t]=n};this._parser.onHeadersComplete=this._parser[s.kOnHeadersComplete]=function(e,t,s,i,n,o){var a=arguments[0];if(typeof a==="object"){i=a.method;n=a.url;o=a.statusCode;s=a.headers}r.method=typeof i==="number"?HttpParser.METHODS[i]:i;r.statusCode=o;r.url=n;if(!s)return;for(var h=0,c=s.length,u,f;h<c;h+=2){u=s[h].toLowerCase();f=s[h+1];if(r.headers.hasOwnProperty(u))r.headers[u]+=", "+f;else r.headers[u]=f}r._complete=true}};HttpParser.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var o=process.version?process.version.match(/[0-9]+/g).map((function(e){return parseInt(e,10)})):[];if(o[0]===0&&o[1]===12){HttpParser.METHODS[16]="REPORT";HttpParser.METHODS[17]="MKACTIVITY";HttpParser.METHODS[18]="CHECKOUT";HttpParser.METHODS[19]="MERGE";HttpParser.METHODS[20]="M-SEARCH";HttpParser.METHODS[21]="NOTIFY";HttpParser.METHODS[22]="SUBSCRIBE";HttpParser.METHODS[23]="UNSUBSCRIBE";HttpParser.METHODS[24]="PATCH";HttpParser.METHODS[25]="PURGE"}HttpParser.prototype.isComplete=function(){return this._complete};HttpParser.prototype.parse=function(e){var t=this._parser.execute(e,0,e.length);if(typeof t!=="number"){this.error=t;this._complete=true;return}if(this._complete)this.body=t<e.length?e.slice(t):i.alloc(0)};e.exports=HttpParser},7969:(e,t,r)=>{"use strict";var s=r(2413).Stream,i=r(1669);var IO=function(e){this.readable=this.writable=true;this._paused=false;this._driver=e};i.inherits(IO,s);IO.prototype.pause=function(){this._paused=true;this._driver.messages._paused=true};IO.prototype.resume=function(){this._paused=false;this.emit("drain");var e=this._driver.messages;e._paused=false;e.emit("drain")};IO.prototype.write=function(e){if(!this.writable)return false;this._driver.parse(e);return!this._paused};IO.prototype.end=function(e){if(!this.writable)return;if(e!==undefined)this.write(e);this.writable=false;var t=this._driver.messages;if(t.readable){t.readable=t.writable=false;t.emit("end")}};IO.prototype.destroy=function(){this.end()};var Messages=function(e){this.readable=this.writable=true;this._paused=false;this._driver=e};i.inherits(Messages,s);Messages.prototype.pause=function(){this._driver.io._paused=true};Messages.prototype.resume=function(){this._driver.io._paused=false;this._driver.io.emit("drain")};Messages.prototype.write=function(e){if(!this.writable)return false;if(typeof e==="string")this._driver.text(e);else this._driver.binary(e);return!this._paused};Messages.prototype.end=function(e){if(e!==undefined)this.write(e)};Messages.prototype.destroy=function(){};t.IO=IO;t.Messages=Messages},348:e=>{"use strict";var t=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,r=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,s=/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/,i=new RegExp(t.source+"(?:=(?:"+t.source+"|"+s.source+"))?"),n=new RegExp(t.source+"(?: *; *"+i.source+")*","g"),o=new RegExp("^"+n.source+"(?: *, *"+n.source+")*$"),a=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/;var h=Object.prototype.hasOwnProperty;var c={parseHeader:function(e){var t=new Offers;if(e===""||e===undefined)return t;if(!o.test(e))throw new SyntaxError("Invalid Sec-WebSocket-Extensions header: "+e);var r=e.match(n);r.forEach((function(e){var r=e.match(new RegExp(i.source,"g")),s=r.shift(),n={};r.forEach((function(e){var t=e.match(i),r=t[1],s;if(t[2]!==undefined){s=t[2]}else if(t[3]!==undefined){s=t[3].replace(/\\/g,"")}else{s=true}if(a.test(s))s=parseFloat(s);if(h.call(n,r)){n[r]=[].concat(n[r]);n[r].push(s)}else{n[r]=s}}),this);t.push(s,n)}),this);return t},serializeParams:function(e,t){var s=[];var print=function(e,t){if(t instanceof Array){t.forEach((function(t){print(e,t)}))}else if(t===true){s.push(e)}else if(typeof t==="number"){s.push(e+"="+t)}else if(r.test(t)){s.push(e+'="'+t.replace(/"/g,'\\"')+'"')}else{s.push(e+"="+t)}};for(var i in t)print(i,t[i]);return[e].concat(s).join("; ")}};var Offers=function(){this._byName={};this._inOrder=[]};Offers.prototype.push=function(e,t){if(!h.call(this._byName,e))this._byName[e]=[];this._byName[e].push(t);this._inOrder.push({name:e,params:t})};Offers.prototype.eachOffer=function(e,t){var r=this._inOrder;for(var s=0,i=r.length;s<i;s++)e.call(t,r[s].name,r[s].params)};Offers.prototype.byName=function(e){return this._byName[e]||[]};Offers.prototype.toArray=function(){return this._inOrder.slice()};e.exports=c},4062:(e,t,r)=>{"use strict";var s=r(8127),i=r(4102);var Cell=function(e){this._ext=e[0];this._session=e[1];this._functors={incoming:new s(this._session,"processIncomingMessage"),outgoing:new s(this._session,"processOutgoingMessage")}};Cell.prototype.pending=function(e){var t=this._functors[e];if(!t._stopped)t.pending+=1};Cell.prototype.incoming=function(e,t,r,s){this._exec("incoming",e,t,r,s)};Cell.prototype.outgoing=function(e,t,r,s){this._exec("outgoing",e,t,r,s)};Cell.prototype.close=function(){this._closed=this._closed||new i;this._doClose();return this._closed};Cell.prototype._exec=function(e,t,r,s,i){this._functors[e].call(t,r,(function(e,t){if(e)e.message=this._ext.name+": "+e.message;s.call(i,e,t);this._doClose()}),this)};Cell.prototype._doClose=function(){var e=this._functors.incoming,t=this._functors.outgoing;if(!this._closed||e.pending+t.pending!==0)return;if(this._session)this._session.close();this._session=null;this._closed.done()};e.exports=Cell},8127:(e,t,r)=>{"use strict";var s=r(9987);var Functor=function(e,t){this._session=e;this._method=t;this._queue=new s(Functor.QUEUE_SIZE);this._stopped=false;this.pending=0};Functor.QUEUE_SIZE=8;Functor.prototype.call=function(e,t,r,s){if(this._stopped)return;var i={error:e,message:t,callback:r,context:s,done:false},n=false,o=this;this._queue.push(i);if(i.error){i.done=true;this._stop();return this._flushQueue()}var handler=function(e,t){if(!(n^(n=true)))return;if(e){o._stop();i.error=e;i.message=null}else{i.message=t}i.done=true;o._flushQueue()};try{this._session[this._method](t,handler)}catch(e){handler(e)}};Functor.prototype._stop=function(){this.pending=this._queue.length;this._stopped=true};Functor.prototype._flushQueue=function(){var e=this._queue,t;while(e.length>0&&e.peek().done){t=e.shift();if(t.error){this.pending=0;e.clear()}else{this.pending-=1}t.callback.call(t.context,t.error,t.message)}};e.exports=Functor},6541:(e,t,r)=>{"use strict";var s=r(4062),i=r(4102);var Pipeline=function(e){this._cells=e.map((function(e){return new s(e)}));this._stopped={incoming:false,outgoing:false}};Pipeline.prototype.processIncomingMessage=function(e,t,r){if(this._stopped.incoming)return;this._loop("incoming",this._cells.length-1,-1,-1,e,t,r)};Pipeline.prototype.processOutgoingMessage=function(e,t,r){if(this._stopped.outgoing)return;this._loop("outgoing",0,this._cells.length,1,e,t,r)};Pipeline.prototype.close=function(e,t){this._stopped={incoming:true,outgoing:true};var r=this._cells.map((function(e){return e.close()}));if(e)i.all(r).then((function(){e.call(t)}))};Pipeline.prototype._loop=function(e,t,r,s,i,n,o){var a=this._cells,h=a.length,c=this;while(h--)a[h].pending(e);var pipe=function(t,i,h){if(t===r)return n.call(o,i,h);a[t][e](i,h,(function(r,i){if(r)c._stopped[e]=true;pipe(t+s,r,i)}))};pipe(t,null,i)};e.exports=Pipeline},4102:(e,t,r)=>{"use strict";var s=r(9987);var Pledge=function(){this._complete=false;this._callbacks=new s(Pledge.QUEUE_SIZE)};Pledge.QUEUE_SIZE=4;Pledge.all=function(e){var t=new Pledge,r=e.length,s=r;if(r===0)t.done();while(s--)e[s].then((function(){r-=1;if(r===0)t.done()}));return t};Pledge.prototype.then=function(e){if(this._complete)e();else this._callbacks.push(e)};Pledge.prototype.done=function(){this._complete=true;var e=this._callbacks,t;while(t=e.shift())t()};e.exports=Pledge},9987:e=>{"use strict";var RingBuffer=function(e){this._bufferSize=e;this.clear()};RingBuffer.prototype.clear=function(){this._buffer=new Array(this._bufferSize);this._ringOffset=0;this._ringSize=this._bufferSize;this._head=0;this._tail=0;this.length=0};RingBuffer.prototype.push=function(e){var t=false,r=false;if(this._ringSize<this._bufferSize){t=this._tail===0}else if(this._ringOffset===this._ringSize){t=true;r=this._tail===0}if(t){this._tail=this._bufferSize;this._buffer=this._buffer.concat(new Array(this._bufferSize));this._bufferSize=this._buffer.length;if(r)this._ringSize=this._bufferSize}this._buffer[this._tail]=e;this.length+=1;if(this._tail<this._ringSize)this._ringOffset+=1;this._tail=(this._tail+1)%this._bufferSize};RingBuffer.prototype.peek=function(){if(this.length===0)return void 0;return this._buffer[this._head]};RingBuffer.prototype.shift=function(){if(this.length===0)return void 0;var e=this._buffer[this._head];this._buffer[this._head]=void 0;this.length-=1;this._ringOffset-=1;if(this._ringOffset===0&&this.length>0){this._head=this._ringSize;this._ringOffset=this.length;this._ringSize=this._bufferSize}else{this._head=(this._head+1)%this._ringSize}return e};e.exports=RingBuffer},6651:(e,t,r)=>{"use strict";var s=r(348),i=r(6541);var Extensions=function(){this._rsv1=this._rsv2=this._rsv3=null;this._byName={};this._inOrder=[];this._sessions=[];this._index={}};Extensions.MESSAGE_OPCODES=[1,2];var n={add:function(e){if(typeof e.name!=="string")throw new TypeError("extension.name must be a string");if(e.type!=="permessage")throw new TypeError('extension.type must be "permessage"');if(typeof e.rsv1!=="boolean")throw new TypeError("extension.rsv1 must be true or false");if(typeof e.rsv2!=="boolean")throw new TypeError("extension.rsv2 must be true or false");if(typeof e.rsv3!=="boolean")throw new TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(e.name))throw new TypeError('An extension with name "'+e.name+'" is already registered');this._byName[e.name]=e;this._inOrder.push(e)},generateOffer:function(){var e=[],t=[],r={};this._inOrder.forEach((function(i){var n=i.createClientSession();if(!n)return;var o=[i,n];e.push(o);r[i.name]=o;var a=n.generateOffer();a=a?[].concat(a):[];a.forEach((function(e){t.push(s.serializeParams(i.name,e))}),this)}),this);this._sessions=e;this._index=r;return t.length>0?t.join(", "):null},activate:function(e){var t=s.parseHeader(e),r=[];t.eachOffer((function(e,t){var i=this._index[e];if(!i)throw new Error('Server sent an extension response for unknown extension "'+e+'"');var n=i[0],o=i[1],a=this._reserved(n);if(a)throw new Error("Server sent two extension responses that use the RSV"+a[0]+' bit: "'+a[1]+'" and "'+n.name+'"');if(o.activate(t)!==true)throw new Error("Server sent unacceptable extension parameters: "+s.serializeParams(e,t));this._reserve(n);r.push(i)}),this);this._sessions=r;this._pipeline=new i(r)},generateResponse:function(e){var t=[],r=[],n=s.parseHeader(e);this._inOrder.forEach((function(e){var i=n.byName(e.name);if(i.length===0||this._reserved(e))return;var o=e.createServerSession(i);if(!o)return;this._reserve(e);t.push([e,o]);r.push(s.serializeParams(e.name,o.generateResponse()))}),this);this._sessions=t;this._pipeline=new i(t);return r.length>0?r.join(", "):null},validFrameRsv:function(e){var t={rsv1:false,rsv2:false,rsv3:false},r;if(Extensions.MESSAGE_OPCODES.indexOf(e.opcode)>=0){for(var s=0,i=this._sessions.length;s<i;s++){r=this._sessions[s][0];t.rsv1=t.rsv1||r.rsv1;t.rsv2=t.rsv2||r.rsv2;t.rsv3=t.rsv3||r.rsv3}}return(t.rsv1||!e.rsv1)&&(t.rsv2||!e.rsv2)&&(t.rsv3||!e.rsv3)},processIncomingMessage:function(e,t,r){this._pipeline.processIncomingMessage(e,t,r)},processOutgoingMessage:function(e,t,r){this._pipeline.processOutgoingMessage(e,t,r)},close:function(e,t){if(!this._pipeline)return e.call(t);this._pipeline.close(e,t)},_reserve:function(e){this._rsv1=this._rsv1||e.rsv1&&e.name;this._rsv2=this._rsv2||e.rsv2&&e.name;this._rsv3=this._rsv3||e.rsv3&&e.name},_reserved:function(e){if(this._rsv1&&e.rsv1)return[1,this._rsv1];if(this._rsv2&&e.rsv2)return[2,this._rsv2];if(this._rsv3&&e.rsv3)return[3,this._rsv3];return false}};for(var o in n)Extensions.prototype[o]=n[o];e.exports=Extensions},2357:e=>{"use strict";e.exports=require("assert")},4293:e=>{"use strict";e.exports=require("buffer")},6417:e=>{"use strict";e.exports=require("crypto")},8614:e=>{"use strict";e.exports=require("events")},5747:e=>{"use strict";e.exports=require("fs")},8605:e=>{"use strict";e.exports=require("http")},1631:e=>{"use strict";e.exports=require("net")},1191:e=>{"use strict";e.exports=require("querystring")},2413:e=>{"use strict";e.exports=require("stream")},4016:e=>{"use strict";e.exports=require("tls")},8835:e=>{"use strict";e.exports=require("url")},1669:e=>{"use strict";e.exports=require("util")}};var t={};function __nccwpck_require__(r){var s=t[r];if(s!==undefined){return s.exports}var i=t[r]={exports:{}};var n=true;try{e[r].call(i.exports,i,i.exports,__nccwpck_require__);n=false}finally{if(n)delete t[r]}return i.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var r=__nccwpck_require__(2387);module.exports=r})();